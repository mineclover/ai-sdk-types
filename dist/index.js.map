{"version":3,"sources":["../src/mcp.ts","../src/messages.ts","../src/providers.ts","../src/stream.ts","../src/tools.ts","../src/usage.ts","../src/ui-schema.ts"],"sourcesContent":["/**\n * MCP (Model Context Protocol) Types\n *\n * Re-exported from @packages/zod-schema with local utilities.\n *\n * @see https://modelcontextprotocol.io/\n */\n\nimport type { OpenAIToolDefinition, ToolSchema } from './tools.js'\n\n// Re-export all MCP types from zod-schema\nexport {\n  type MCPToolAnnotations,\n  type MCPToolDefinition,\n  type MCPResourceDefinition,\n  type MCPPromptArgument,\n  type MCPPromptDefinition,\n  type MCPOAuth2AuthConfig,\n  type MCPAuthConfig,\n  type MCPMetadata,\n  type CollectedToolInfo,\n} from '@packages/zod-schema'\n\nimport type {\n  MCPToolDefinition,\n  MCPMetadata,\n  CollectedToolInfo,\n} from '@packages/zod-schema'\n\n// ============================================\n// Conversion Utilities\n// ============================================\n\n/**\n * Convert MCP tool definition to AI SDK ToolSchema\n */\nexport function mcpToolToSchema(tool: MCPToolDefinition): ToolSchema {\n  return {\n    description: tool.description,\n    inputSchema: tool.inputSchema,\n    outputSchema: tool.outputSchema,\n  }\n}\n\n/**\n * Convert MCP tool definition to OpenAI format\n */\nexport function mcpToolToOpenAI(name: string, tool: MCPToolDefinition): OpenAIToolDefinition {\n  return {\n    type: 'function',\n    function: {\n      name,\n      description: tool.description,\n      parameters: {\n        type: 'object',\n        properties: (tool.inputSchema.properties as Record<string, unknown>) ?? {},\n        required: tool.inputSchema.required,\n      },\n    },\n  }\n}\n\n/**\n * Convert MCP metadata tools to OpenAI format\n */\nexport function mcpMetadataToOpenAITools(metadata: MCPMetadata): OpenAIToolDefinition[] {\n  return metadata.tools.map((tool) => mcpToolToOpenAI(tool.name, tool))\n}\n\n/**\n * Collect tools from multiple MCP metadata sources\n *\n * @param sources - Map of namespace to MCP metadata\n * @returns Collected tool info with OpenAI and AI SDK formats\n */\nexport function collectMCPTools(sources: Record<string, MCPMetadata>): CollectedToolInfo {\n  const openaiTools: OpenAIToolDefinition[] = []\n  const aiTools: Record<string, ToolSchema> = {}\n  const summary: Record<string, number> = {}\n\n  for (const [namespace, metadata] of Object.entries(sources)) {\n    summary[namespace] = metadata.tools.length\n\n    for (const tool of metadata.tools) {\n      const fullName = `${namespace}:${tool.name}`\n\n      // Add to OpenAI format with namespaced name\n      openaiTools.push(mcpToolToOpenAI(fullName, tool))\n\n      // Add to AI SDK format\n      aiTools[fullName] = mcpToolToSchema(tool)\n    }\n  }\n\n  return {\n    openaiTools,\n    aiTools,\n    summary,\n    totalTools: openaiTools.length,\n  }\n}\n","/**\n * Message Types\n * Re-exported from @packages/zod-schema\n */\n\n// Re-export all message types from zod-schema\nexport {\n  // Types\n  type MessageRole,\n  type Message,\n  type MessageContent,\n  type MessageContentType,\n  type TextPart,\n  type ToolCallPart,\n  type ToolResultPart,\n  type MessagePart,\n  // Type guards\n  isTextPart,\n  isToolCallPart,\n  isToolResultPart,\n} from '@packages/zod-schema'\n\n// Re-export ToolCall from zod-schema (note: different structure)\nexport { type ToolCall } from '@packages/zod-schema'\n\n// Local type that differs from zod-schema\n// This is OpenAI-compatible format, kept for backwards compatibility\nexport interface ToolDefinition {\n  type: 'function'\n  function: {\n    name: string\n    description?: string\n    parameters?: {\n      type: 'object'\n      properties: Record<string, unknown>\n      required?: string[]\n    }\n  }\n}\n","/**\n * Provider Types\n * Re-exported from @packages/zod-schema\n */\n\nexport {\n  // Types\n  type Provider,\n  type ClaudeModel,\n  type OpenAIModel,\n  type GoogleModel,\n  type Model,\n  type ProviderCredentials,\n  // Utilities\n  getProviderFromModel,\n} from '@packages/zod-schema'\n","/**\n * Stream Communication Types\n * Re-exported from @packages/zod-schema\n */\n\n// Re-export ToolDefinition from messages for convenience\nexport type { ToolDefinition } from './messages.js'\n\n// Re-export all stream types from zod-schema\nexport {\n  // Types\n  type StreamRequest,\n  type StreamChunk,\n  type StreamEnd,\n  type StreamError,\n  type StreamMessage,\n  type ChatMessage,\n  type ChatToolCall,\n  type ChatToolDefinition,\n  type ChatRequest,\n  type ChatResponse,\n  type FinishReason,\n  type UnifiedChatResponse,\n  // Utilities\n  mapFinishReason,\n} from '@packages/zod-schema'\n","/**\n * Tool Types (AI SDK 5 compatible)\n *\n * Re-exported from @packages/zod-schema with local extensions.\n *\n * @see https://ai-sdk.dev/docs/ai-sdk-core/tools-and-tool-calling\n */\n\n// Re-export base types from zod-schema\nexport {\n  type JSONSchema,\n  type ToolSchema,\n  type OpenAIToolDefinition,\n} from '@packages/zod-schema'\n\nimport type { JSONSchema, ToolSchema, OpenAIToolDefinition } from '@packages/zod-schema'\n\n// ============================================\n// Tool Execution Options (local extension)\n// ============================================\n\n/** Tool execution options (AI SDK 5 compatible) */\nexport interface ToolExecutionOptions {\n  /** Unique identifier for this tool call */\n  toolCallId?: string\n  /** Abort signal for cancellation */\n  abortSignal?: AbortSignal\n}\n\n// ============================================\n// Tool Definition (AI SDK 5) - with execute\n// ============================================\n\n/**\n * AI SDK 5 compatible tool definition with execute function\n *\n * Unlike OpenAI format (type: 'function' wrapper), this is a flat structure\n * aligned with MCP and AI SDK 5.\n */\nexport interface Tool<TInput = unknown, TOutput = unknown> {\n  /** Tool description for LLM to understand when to use it */\n  description: string\n  /** JSON Schema for input validation */\n  inputSchema: JSONSchema\n  /** Optional JSON Schema for output (MCP compatible) */\n  outputSchema?: JSONSchema\n  /** Execute function */\n  execute: (input: TInput, options?: ToolExecutionOptions) => Promise<TOutput>\n}\n\n// ============================================\n// Tool Registry Types (local extensions)\n// ============================================\n\n/** Registry of tools by name */\nexport type ToolRegistry<T extends Record<string, Tool>> = T\n\n/** Extract tool names from registry */\nexport type ToolName<T extends ToolRegistry<Record<string, Tool>>> = keyof T\n\n/** Extract input type from a tool */\nexport type ToolInput<T extends Tool> = T extends Tool<infer I, unknown> ? I : never\n\n/** Extract output type from a tool */\nexport type ToolOutput<T extends Tool> = T extends Tool<unknown, infer O> ? O : never\n\n// ============================================\n// Conversion Utilities\n// ============================================\n\n/**\n * Convert AI SDK 5 Tool to OpenAI-compatible format\n */\nexport function toOpenAITool(name: string, tool: ToolSchema): OpenAIToolDefinition {\n  return {\n    type: 'function',\n    function: {\n      name,\n      description: tool.description,\n      parameters: {\n        type: 'object',\n        properties: (tool.inputSchema.properties as Record<string, unknown>) ?? {},\n        required: tool.inputSchema.required,\n      },\n    },\n  }\n}\n\n/**\n * Convert tool registry to OpenAI-compatible format\n */\nexport function toOpenAITools<T extends Record<string, ToolSchema>>(tools: T): OpenAIToolDefinition[] {\n  return Object.entries(tools).map(([name, tool]) => toOpenAITool(name, tool))\n}\n","/**\n * Token Usage Types\n * Re-exported from @packages/zod-schema\n */\n\nexport {\n  // Types\n  type UsageInfo,\n  type UsageWithCost,\n  type TokenPricing,\n  // Utilities\n  estimateTokens,\n  estimatePromptTokens,\n} from '@packages/zod-schema'\n","/**\n * UI Schema Extensions for AI SDK Tools\n *\n * Extends JSON Schema with UI-specific properties using x- prefix\n * to avoid conflicts with JSON Schema standard.\n *\n * Based on OpenAPI extension pattern (x-* properties).\n */\n\nimport type { JSONSchema, ToolSchema } from './tools.js'\n\n// Re-export common types from zod-schema\nexport {\n  type UIWidgetType,\n  type FieldDirection,\n  type FlowNodeType,\n  type ShortcutConfig,\n  type BranchMetadata,\n  type NodePosition,\n  type StateConnection,\n} from '@packages/zod-schema'\n\nimport type {\n  UIWidgetType,\n  FieldDirection,\n  FlowNodeType,\n  ShortcutConfig,\n  BranchMetadata,\n  NodePosition,\n  StateConnection,\n} from '@packages/zod-schema'\n\n// ============================================\n// UI Property Schema (per-property extensions)\n// ============================================\n\n/**\n * JSON Schema property with UI extensions\n *\n * Uses x- prefix for UI-specific properties to avoid JSON Schema conflicts.\n * All standard JSON Schema properties are supported via index signature.\n */\nexport interface UIPropertySchema extends JSONSchema {\n  // JSON Schema standard properties (commonly used)\n  type: 'string' | 'number' | 'integer' | 'boolean' | 'array' | 'object' | 'null'\n  description?: string\n  default?: unknown\n  enum?: unknown[]\n  const?: unknown\n\n  // String validations\n  pattern?: string\n  minLength?: number\n  maxLength?: number\n  format?: string // 'date', 'time', 'date-time', 'email', 'uri', etc.\n\n  // Number validations\n  minimum?: number\n  maximum?: number\n  exclusiveMinimum?: number\n  exclusiveMaximum?: number\n  multipleOf?: number\n\n  // Array validations\n  items?: UIPropertySchema\n  minItems?: number\n  maxItems?: number\n  uniqueItems?: boolean\n\n  // Object validations\n  properties?: Record<string, UIPropertySchema>\n  required?: string[]\n  additionalProperties?: boolean | UIPropertySchema\n\n  // ============================================\n  // UI Extensions (x- prefix)\n  // ============================================\n\n  /** UI widget override - changes visual representation */\n  'x-widget'?: UIWidgetType\n\n  /** Color presets for color widget */\n  'x-presets'?: string[]\n\n  /** Step increment for number inputs */\n  'x-step'?: number\n\n  /** Placeholder text for inputs */\n  'x-placeholder'?: string\n\n  /** Help text displayed below input */\n  'x-help'?: string\n\n  /** Display label (if different from property name) */\n  'x-label'?: string\n\n  /** Display order (lower = first) */\n  'x-order'?: number\n\n  /** Whether field is hidden in UI */\n  'x-hidden'?: boolean\n\n  /** Whether field is read-only in UI */\n  'x-readonly'?: boolean\n\n  /** Field group for organizing UI */\n  'x-group'?: string\n\n  // ============================================\n  // Flow Extensions (x-flow-* prefix)\n  // ============================================\n\n  /** Field direction for flow nodes */\n  'x-flow-direction'?: FieldDirection\n\n  /** State source - if this input comes from another node's output */\n  'x-flow-state-from'?: {\n    nodeId: string\n    field: string\n  }\n}\n\n// ============================================\n// UI Tool Definition\n// ============================================\n\n/**\n * Tool definition with UI extensions\n *\n * Extends ToolSchema with UI and flow-specific metadata.\n */\nexport interface UIToolDefinition extends ToolSchema {\n  /** Input schema with UI extensions */\n  inputSchema: UIPropertySchema & { type: 'object' }\n\n  /** Output schema with UI extensions (optional) */\n  outputSchema?: UIPropertySchema\n\n  // ============================================\n  // UI Extensions (x- prefix)\n  // ============================================\n\n  /** Keyboard shortcuts for this tool */\n  'x-shortcuts'?: ShortcutConfig[]\n\n  /** Example usage strings */\n  'x-examples'?: string[]\n\n  /** Display category for grouping */\n  'x-category'?: string\n\n  /** Tags for filtering and search */\n  'x-tags'?: string[]\n\n  /** Display icon (icon name or URL) */\n  'x-icon'?: string\n\n  /** Whether tool is deprecated */\n  'x-deprecated'?: boolean\n\n  /** Deprecation message */\n  'x-deprecated-message'?: string\n\n  // ============================================\n  // Flow Extensions (x-flow-* prefix)\n  // ============================================\n\n  /** Node type in flow graph */\n  'x-flow-node-type'?: FlowNodeType\n\n  /** Possible branch outcomes (query nodes only) */\n  'x-flow-branches'?: BranchMetadata[]\n\n  /** Flow context/group identifier */\n  'x-flow-context'?: string\n\n  /** Visual position in canvas */\n  'x-flow-position'?: NodePosition\n\n  /** State connections for this node */\n  'x-flow-connections'?: StateConnection[]\n}\n\n// ============================================\n// UI Tool with Execute Function\n// ============================================\n\n/**\n * UI Tool with execute function\n */\nexport interface UITool<TInput = unknown, TOutput = unknown> extends UIToolDefinition {\n  /** Execute function */\n  execute: (input: TInput, options?: { toolCallId?: string; abortSignal?: AbortSignal }) => Promise<TOutput>\n}\n\n// ============================================\n// Type Guards\n// ============================================\n\n/** Check if schema has UI extensions */\nexport function hasUIExtensions(schema: JSONSchema): schema is UIPropertySchema {\n  return Object.keys(schema).some((key) => key.startsWith('x-'))\n}\n\n/** Check if tool has UI extensions */\nexport function hasUIToolExtensions(tool: ToolSchema): tool is UIToolDefinition {\n  return Object.keys(tool).some((key) => key.startsWith('x-')) || hasUIExtensions(tool.inputSchema)\n}\n\n/** Check if tool has flow extensions */\nexport function hasFlowExtensions(tool: ToolSchema): boolean {\n  return Object.keys(tool).some((key) => key.startsWith('x-flow-'))\n}\n\n/** Check if tool is a query node (has branches) */\nexport function isQueryNode(tool: UIToolDefinition): boolean {\n  return tool['x-flow-node-type'] === 'query' || (tool['x-flow-branches']?.length ?? 0) > 0\n}\n\n/** Check if tool is an effect node */\nexport function isEffectNode(tool: UIToolDefinition): boolean {\n  return tool['x-flow-node-type'] === 'effect'\n}\n"],"mappings":";AAoCO,SAAS,gBAAgB,MAAqC;AACnE,SAAO;AAAA,IACL,aAAa,KAAK;AAAA,IAClB,aAAa,KAAK;AAAA,IAClB,cAAc,KAAK;AAAA,EACrB;AACF;AAKO,SAAS,gBAAgB,MAAc,MAA+C;AAC3F,SAAO;AAAA,IACL,MAAM;AAAA,IACN,UAAU;AAAA,MACR;AAAA,MACA,aAAa,KAAK;AAAA,MAClB,YAAY;AAAA,QACV,MAAM;AAAA,QACN,YAAa,KAAK,YAAY,cAA0C,CAAC;AAAA,QACzE,UAAU,KAAK,YAAY;AAAA,MAC7B;AAAA,IACF;AAAA,EACF;AACF;AAKO,SAAS,yBAAyB,UAA+C;AACtF,SAAO,SAAS,MAAM,IAAI,CAAC,SAAS,gBAAgB,KAAK,MAAM,IAAI,CAAC;AACtE;AAQO,SAAS,gBAAgB,SAAyD;AACvF,QAAM,cAAsC,CAAC;AAC7C,QAAM,UAAsC,CAAC;AAC7C,QAAM,UAAkC,CAAC;AAEzC,aAAW,CAAC,WAAW,QAAQ,KAAK,OAAO,QAAQ,OAAO,GAAG;AAC3D,YAAQ,SAAS,IAAI,SAAS,MAAM;AAEpC,eAAW,QAAQ,SAAS,OAAO;AACjC,YAAM,WAAW,GAAG,SAAS,IAAI,KAAK,IAAI;AAG1C,kBAAY,KAAK,gBAAgB,UAAU,IAAI,CAAC;AAGhD,cAAQ,QAAQ,IAAI,gBAAgB,IAAI;AAAA,IAC1C;AAAA,EACF;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA,YAAY,YAAY;AAAA,EAC1B;AACF;;;AC9FA;AAAA,EAWE;AAAA,EACA;AAAA,EACA;AAAA,OACK;;;ACfP;AAAA,EASE;AAAA,OACK;;;ACNP;AAAA,EAeE;AAAA,OACK;;;ACgDA,SAAS,aAAa,MAAc,MAAwC;AACjF,SAAO;AAAA,IACL,MAAM;AAAA,IACN,UAAU;AAAA,MACR;AAAA,MACA,aAAa,KAAK;AAAA,MAClB,YAAY;AAAA,QACV,MAAM;AAAA,QACN,YAAa,KAAK,YAAY,cAA0C,CAAC;AAAA,QACzE,UAAU,KAAK,YAAY;AAAA,MAC7B;AAAA,IACF;AAAA,EACF;AACF;AAKO,SAAS,cAAoD,OAAkC;AACpG,SAAO,OAAO,QAAQ,KAAK,EAAE,IAAI,CAAC,CAAC,MAAM,IAAI,MAAM,aAAa,MAAM,IAAI,CAAC;AAC7E;;;ACxFA;AAAA,EAME;AAAA,EACA;AAAA,OACK;;;AC2LA,SAAS,gBAAgB,QAAgD;AAC9E,SAAO,OAAO,KAAK,MAAM,EAAE,KAAK,CAAC,QAAQ,IAAI,WAAW,IAAI,CAAC;AAC/D;AAGO,SAAS,oBAAoB,MAA4C;AAC9E,SAAO,OAAO,KAAK,IAAI,EAAE,KAAK,CAAC,QAAQ,IAAI,WAAW,IAAI,CAAC,KAAK,gBAAgB,KAAK,WAAW;AAClG;AAGO,SAAS,kBAAkB,MAA2B;AAC3D,SAAO,OAAO,KAAK,IAAI,EAAE,KAAK,CAAC,QAAQ,IAAI,WAAW,SAAS,CAAC;AAClE;AAGO,SAAS,YAAY,MAAiC;AAC3D,SAAO,KAAK,kBAAkB,MAAM,YAAY,KAAK,iBAAiB,GAAG,UAAU,KAAK;AAC1F;AAGO,SAAS,aAAa,MAAiC;AAC5D,SAAO,KAAK,kBAAkB,MAAM;AACtC;","names":[]}